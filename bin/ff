#!/bin/sh

# search for files and vi them

# detect if we're inside a git repo
if git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
    # use git ls-files
    FILELIST=$(git ls-files | grep -i "$1")
else
    # fallback to find
    FILELIST=$(find -L ./ -type f -iname "*$1*" 2>/dev/null | grep -v ".git/")
fi

# apply inclusion/exclusion filter $2
if [ "$3" = "-" ]; then
    FILTERED=$(echo "$FILELIST" | grep -v "$2")
else
    FILTERED=$(echo "$FILELIST" | grep "$2")
fi

# build vi commands
RES=$(echo "$FILTERED" | sed 's|^|vi |')

# extract unique file paths
FILES=$(echo "$RES" | awk '{print $2}' | sed 's/^\.\///' | sed 's/:\([0-9][0-9]*\)://' | sort | uniq)

echo vi $FILES
echo
echo "$RES"
